# Права

На уровне файловой системы права регулируются с помощью нескольких механизмов. В первую очередь это стандартная система прав. У каждого файла или каталога есть биты, которые представляются в виде:
```
rwxrwxrwx
или
777

777 получается при:
r + w + x
4 + 2 + 1
```

Каждый набор rwx описывает права владельца, группы и всех остальных на этот файл. Например, в примере выше с данным объектом можно выполнять любые действия от имени любого пользователя. Соответственно, у каждого файла указан владелец и группа, на которые применяются права, согласно первым двум наборам.


```
owner group other
rwx   rwx   rwx
```

Для того, чтобы посмотреть как это выглядит в релаьной файловой системе достаточно запустить ls -la.

Для более расширенных возможностей существует ACL. Кроме того, есть много всего другого. Например, что-то относится к тому, как реализованы временные файлы (/tmp), а что-то к защите от чтения файла, который хранит пароли системы. Подробнее по ссылкам. Здесь рассматриваются основы прав.

Подробнее: https://en.wikipedia.org/wiki/File-system_permissions
Подробнее: https://habr.com/ru/articles/469667/

## whoami
Для того, чтобы узнать под каким пользователем запущен текущий терминал можно воспользоваться командой whoami.

```
$ whoami
user
```

## groups
Для того, чтобы узнать группы текущего пользователя можно воспользоваться командой groups.
```
$ groups
sys network power vboxusers docker lp wheel danya

```

## w
При работе с системой можно узнать какие пользователи и что делают прямо сейчас. Для этого есть команда w.

```
$ w
 19:34:26 up 6 days,  3:22,  2 users,  load average: 1,46, 2,08, 2,33
USER     TTY       LOGIN@   IDLE   JCPU   PCPU  WHAT
user               some-day 21:30  0.00s  5.87s /usr/lib/systemd/systemd --user
...
```

## su, sudo, systemd run0

Команды su и sudo уже обсуждались в базовом модуле, как и их использование. Можно дополнить тем, что они не идеальны. sudo - имеет слишком большую кодовую базу, слишком много лишних возможностей, но имеет важные возможности из-за которых его всё же используют чаще. Например, это возможность выполнять только определенные действия от имени root или возможность получить права root, не зная пароля root (используя пароль своего пользователя). В любом случае, на уровне системы у данных утилит есть проблема, а конкретнее все запускаемые действия на уровне системы, хоть и имеют права нового пользователя, но работают в контексте изначального (см. systemd slice). Данные проблемы решает systemd run0, что полезно изучить.

https://www.comss.ru/page.php?id=13538
https://man.archlinux.org/man/run0.1.en

Конкретно данная особенность с systemd slice у нас возникала, когда с помощью cgroups на летней школе мы накладывали ограничения на ресурсы пользователей (cpu, ram, disk). В случае, если пользователь подключатся не на прямую, а логин происходил через другого (при тестировании root -> user) возникало то, что ограничения не накладывались, потому что slice оставался от пользователя root, поэтому в данном случае удобно было использовать run0 для тестирования.

## chmod

Позволяет изменить права.
```
# chmod +x file
```
После такого файл станет доступным на исполнение.

## chown
Позволяет поменять владельца и группу.
```
chown root /u        # Меняет владельца /u на «root».
chown root:staff /u  # То же, но еще меняет группу на «staff».
chown -hR root /u    # Меняет владельца /u и вложенных файлов на «root».
```


